SET search_path TO projet;


-- Sch√©ma

DROP SCHEMA IF EXISTS projet CASCADE;
CREATE SCHEMA projet AUTHORIZATION projet;
GRANT ALL PRIVILEGES ON SCHEMA projet TO projet;


-- Tables

CREATE TABLE compte (
	IdCompte		INT			 	NOT NULL	GENERATED BY DEFAULT AS IDENTITY,
	Pseudo			VARCHAR(25)		NOT NULL,
	MotDePasse		VARCHAR(25) 	NOT NULL,
	Email			VARCHAR(100)	NOT NULL,
	PRIMARY KEY (IdCompte)
);
CREATE UNIQUE INDEX idx_compte_pseudo ON compte (Pseudo ASC);

CREATE TABLE role (
	IdCompte		INT				NOT NULL,
	Role			VARCHAR(20)		NOT NULL,
	CHECK( Role IN ('ADMINISTRATEUR','UTILISATEUR') ),	
	FOREIGN KEY (IdCompte) REFERENCES compte (IdCompte),
	PRIMARY KEY (IdCompte, Role)
);

CREATE TABLE utilisateur (
	idutilisateur	INT				NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	nom				VARCHAR(50)		NOT NULL,
	prenom			VARCHAR(50)		NOT NULL,
	email			VARCHAR(50)		NOT NULL,
	motdepasse		VARCHAR(50)		NOT NULL,
	role			VARCHAR(20)		NOT NULL,
	CHECK( role IN('PARENT','GESTIONNAIRE')),
	paiement		INT 			NOT NULL,
	PRIMARY KEY (idutilisateur)
);

CREATE TABLE enfant (
	idenfant				INT				NOT NULL GENERATED BY DEFAULT AS IDENTITY,
	Idutilisateur		INT			 	NOT NULL,
	nom				VARCHAR(50)		NOT NULL,
	prenom			VARCHAR(50)		NOT NULL,
	datedenaissance	DATE			NOT NULL,
	etabfrequente	VARCHAR(50)		NOT NULL,
	niveauetude		VARCHAR(20)		NOT NULL,
	CHECK(niveauetude IN('SIXIEME', 'CINQUIEME', 'QUATRIEME', 'TROISIEME', 'SECONDE', 'PREMIERE', 'TERMINALE')),
	creneauchoisi	TIME			NOT NULL,
	modedepaiement	VARCHAR(20)		NOT NULL,
	CHECK( modedepaiement IN('CHEQUE', 'ESPECES', 'VIREMENT')),
	FOREIGN KEY (Idutilisateur) REFERENCES utilisateur (Idutilisateur),
	PRIMARY KEY(idenfant)
);
